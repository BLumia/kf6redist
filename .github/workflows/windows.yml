name: Windows CI

on:
  push:
  pull_request:
  workflow_dispatch:
    inputs:
      qt_ver:
        description: 'Qt Version to use'
        required: false
        default: '6.10.2'

jobs:
  msvc-build:
    runs-on: windows-2022

    env:
      QT_VER: ${{ inputs.qt_ver || '6.10.2' }}
      VS_VER: '2022'
      AQT_ARCH: 'win64_msvc2022_64'
      MSVC_ARCH: 'x64'

    steps:
    - uses: actions/checkout@v5
    - name: Install Qt
      uses: jurplel/install-qt-action@v4
      with:
        arch: ${{ env.AQT_ARCH }}
        version: ${{ env.QT_VER }}
        cache: true
    - uses: MinoruSekine/setup-scoop@v4.0.2
      with:
        buckets: extras
        apps: gettext
    - name: Enable long paths for Windows
      run: |
        New-ItemProperty -Path "HKLM:System\CurrentControlSet\Control\FileSystem" `
          -Name "LongPathsEnabled" -Value 1 -Type DWORD -Force
    - name: build
      run: .\build.ps1
    - uses: actions/upload-artifact@v4
      with:
        name: "win${{ env.MSVC_ARCH }}-msvc${{ env.VS_VER }}-qt${{ env.QT_VER }}${{ inputs.tag_ver && format('-{0}', inputs.tag_ver) || '' }}-kf6.23.0"
        path: kf6redist-install/*
